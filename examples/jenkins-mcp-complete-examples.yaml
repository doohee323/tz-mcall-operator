---
# ============================================
# Jenkins MCP Server 통합 예제
# ============================================

# 1. Job 목록 조회 (간단)
apiVersion: mcall.tz.io/v1
kind: McallTask
metadata:
  name: jenkins-list-jobs
  namespace: default
spec:
  type: mcp-client
  schedule: "*/10 * * * *"  # 10분마다
  input: ""
  mcpConfig:
    serverUrl: "https://jenkins.drillquiz.com/mcp-server/mcp"
    toolName: "getJobs"
    arguments:
      offset: 0
      limit: 5  # 5개 job만 조회
    auth:
      type: "basic"
      secretRef:
        name: jenkins-mcp-credentials
        namespace: default
      usernameKey: "username"
      passwordKey: "token"
    headers:
      Accept: "text/event-stream, application/json"
    connectionTimeout: 30
---
# 2. 특정 Job 상세 정보 조회
apiVersion: mcall.tz.io/v1
kind: McallTask
metadata:
  name: jenkins-get-crd-job-detail
  namespace: default
spec:
  type: mcp-client
  schedule: "*/15 * * * *"  # 15분마다
  input: ""
  mcpConfig:
    serverUrl: "https://jenkins.drillquiz.com/mcp-server/mcp"
    toolName: "getJob"
    arguments:
      jobFullName: "tz-drillquiz-crd"
    auth:
      type: "basic"
      secretRef:
        name: jenkins-mcp-credentials
        namespace: default
      usernameKey: "username"
      passwordKey: "token"
    headers:
      Accept: "text/event-stream, application/json"
    connectionTimeout: 30
---
# 3. 특정 빌드 정보 조회
apiVersion: mcall.tz.io/v1
kind: McallTask
metadata:
  name: jenkins-get-last-build
  namespace: default
spec:
  type: mcp-client
  schedule: "*/20 * * * *"  # 20분마다
  input: ""
  mcpConfig:
    serverUrl: "https://jenkins.drillquiz.com/mcp-server/mcp"
    toolName: "getBuild"
    arguments:
      jobFullName: "tz-drillquiz-crd"
      # buildNumber 생략 = last build
    auth:
      type: "basic"
      secretRef:
        name: jenkins-mcp-credentials
        namespace: default
      usernameKey: "username"
      passwordKey: "token"
    headers:
      Accept: "text/event-stream, application/json"
    connectionTimeout: 30
---
# 4. 빌드 로그 조회
apiVersion: mcall.tz.io/v1
kind: McallTask
metadata:
  name: jenkins-get-build-log
  namespace: default
spec:
  type: mcp-client
  schedule: "*/30 * * * *"  # 30분마다
  input: ""
  mcpConfig:
    serverUrl: "https://jenkins.drillquiz.com/mcp-server/mcp"
    toolName: "getBuildLog"
    arguments:
      jobFullName: "tz-drillquiz-crd"
      # buildNumber 생략 = last build
      offset: 0
      limit: 100  # 최근 100 라인
    auth:
      type: "basic"
      secretRef:
        name: jenkins-mcp-credentials
        namespace: default
      usernameKey: "username"
      passwordKey: "token"
    headers:
      Accept: "text/event-stream, application/json"
    connectionTimeout: 30
---
# 5. 빌드 트리거 (파라미터 없음)
apiVersion: mcall.tz.io/v1
kind: McallTask
metadata:
  name: jenkins-trigger-crd-build
  namespace: default
spec:
  type: mcp-client
  schedule: "0 2 * * *"  # 매일 오전 2시
  input: ""
  mcpConfig:
    serverUrl: "https://jenkins.drillquiz.com/mcp-server/mcp"
    toolName: "triggerBuild"
    arguments:
      jobFullName: "tz-drillquiz-crd"
    auth:
      type: "basic"
      secretRef:
        name: jenkins-mcp-credentials
        namespace: default
      usernameKey: "username"
      passwordKey: "token"
    headers:
      Accept: "text/event-stream, application/json"
    connectionTimeout: 30
---
# 6. 파라미터화된 빌드 트리거
apiVersion: mcall.tz.io/v1
kind: McallTask
metadata:
  name: jenkins-trigger-usecase-build
  namespace: default
spec:
  type: mcp-client
  schedule: "0 3 * * *"  # 매일 오전 3시
  input: ""
  mcpConfig:
    serverUrl: "https://jenkins.drillquiz.com/mcp-server/mcp"
    toolName: "triggerBuild"
    arguments:
      jobFullName: "tz-drillquiz-usecase"
      parameters:
        USECASE_TARGET_DOMAIN: "drillquiz-usecase.devops-qa.svc.cluster.local"
        USECASE_TARGET_PORT: "80"
        USECASE_TEST_TYPE: "k8s-qa"
    auth:
      type: "basic"
      secretRef:
        name: jenkins-mcp-credentials
        namespace: default
      usernameKey: "username"
      passwordKey: "token"
    headers:
      Accept: "text/event-stream, application/json"
    connectionTimeout: 30
---
# 7. Jenkins 상태 체크
apiVersion: mcall.tz.io/v1
kind: McallTask
metadata:
  name: jenkins-health-check
  namespace: default
spec:
  type: mcp-client
  schedule: "*/5 * * * *"  # 5분마다
  input: ""
  mcpConfig:
    serverUrl: "https://jenkins.drillquiz.com/mcp-server/mcp"
    toolName: "getStatus"
    arguments: {}  # 파라미터 없음
    auth:
      type: "basic"
      secretRef:
        name: jenkins-mcp-credentials
        namespace: default
      usernameKey: "username"
      passwordKey: "token"
    headers:
      Accept: "text/event-stream, application/json"
    connectionTimeout: 30
---
# 8. 현재 사용자 정보 조회
apiVersion: mcall.tz.io/v1
kind: McallTask
metadata:
  name: jenkins-whoami
  namespace: default
spec:
  type: mcp-client
  schedule: "0 * * * *"  # 매시간
  input: ""
  mcpConfig:
    serverUrl: "https://jenkins.drillquiz.com/mcp-server/mcp"
    toolName: "whoAmI"
    arguments: {}
    auth:
      type: "basic"
      secretRef:
        name: jenkins-mcp-credentials
        namespace: default
      usernameKey: "username"
      passwordKey: "token"
    headers:
      Accept: "text/event-stream, application/json"
    connectionTimeout: 30
---
# Shared Secret
apiVersion: v1
kind: Secret
metadata:
  name: jenkins-mcp-credentials
  namespace: default
type: Opaque
stringData:
  username: "admin"
  token: "11197fa40f409842983025803948aa6bcc"

