# Jenkins ë³µì› ì‘ì—… ê¸°ë¡

## ëª©í‘œ
Veleroì—ì„œ ê°€ì¥ ì˜¤ë˜ëœ ë°±ì—…ìœ¼ë¡œ Jenkinsë§Œ ë³µì›í•˜ë˜, í”ŒëŸ¬ê·¸ì¸ì€ ì—†ì–´ë„ ë˜ì§€ë§Œ í”„ë¡œì íŠ¸ í´ë”ëŠ” ìœ ì§€í•œ ìƒíƒœë¡œ UIë§Œ ë„ìš°ê¸°

## ì‘ì—… ë‚´ì—­

### 1ë‹¨ê³„: ì´ˆê¸° ìƒí™© íŒŒì•…
- Jenkins 2.462.3 ì‹¤í–‰ ì¤‘
- í”ŒëŸ¬ê·¸ì¸ ì—†ìŒ (Pipeline, Git, Kubernetes ë“± í•„ìˆ˜ í”ŒëŸ¬ê·¸ì¸ ë¯¸ì„¤ì¹˜)
- ë³´ì•ˆ ì·¨ì•½ì  ê²½ê³  3ê°œ ì¡´ì¬

### 2ë‹¨ê³„: í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ ì‹œë„
**ë¬¸ì œ ë°œìƒ**: í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ ì‹¤íŒ¨
```
java.nio.file.AccessDeniedException: /var/jenkins_home/plugins/structs.jpi.tmp
```

**ì›ì¸**: 
- Velero ë³µì› ì‹œ `/var/jenkins_home/plugins` ë””ë ‰í† ë¦¬ê°€ `root:root` ì†Œìœ 
- JenkinsëŠ” `jenkins:jenkins` (uid=1000)ë¡œ ì‹¤í–‰ë˜ì–´ ì“°ê¸° ê¶Œí•œ ì—†ìŒ
- fsGroupì€ ìƒˆ íŒŒì¼ì—ë§Œ ì ìš©ë˜ê³  ê¸°ì¡´ íŒŒì¼ ê¶Œí•œì€ ë³€ê²½í•˜ì§€ ì•ŠìŒ

### 3ë‹¨ê³„: ê¶Œí•œ ìˆ˜ì • ì‹œë„
**ì‹œë„ 1**: ì„ì‹œ Podë¡œ ê¶Œí•œ ìˆ˜ì •
```bash
kubectl run fix-permissions --rm -i --overrides='...'
chown -R 1000:1000 /var/jenkins_home/plugins
```
âœ… ì„±ê³µí–ˆìœ¼ë‚˜ ì¬ì‹œì‘ ì‹œ ë‹¤ì‹œ ë¬¸ì œ ë°œìƒ

**ì‹œë„ 2**: StatefulSetì— InitContainer ì¶”ê°€
```bash
kubectl patch statefulset jenkins -n jenkins --type=json -p='[...]'
```
âŒ `Init:CreateContainerConfigError` ë°œìƒ

### 4ë‹¨ê³„: ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘
**ê²°ì •**: Velero ê°€ì¥ ì˜¤ë˜ëœ ë°±ì—…ìœ¼ë¡œ ì™„ì „íˆ ìƒˆë¡œ ë³µì›

1. í˜„ì¬ Jenkins namespace ì‚­ì œ
```bash
kubectl delete namespace jenkins
```

2. Velero ë°±ì—… ëª©ë¡ í™•ì¸
- ê°€ì¥ ì˜¤ë˜ëœ ë°±ì—…: `jenkins-pre-upgrade-20251011-201802`

3. ë³µì› ì‹¤í–‰
```bash
kubectl create -f - <<EOF
apiVersion: velero.io/v1
kind: Restore
metadata:
  name: restore-jenkins-oldest-20251012-141212
  namespace: velero
spec:
  backupName: jenkins-pre-upgrade-20251011-201802
  includedNamespaces:
  - jenkins
  restorePVs: true
EOF
```
âœ… ë³µì› ì™„ë£Œ: 44ê°œ ì•„ì´í…œ ë³µì›, 7ê°œ ê²½ê³ 

### 5ë‹¨ê³„: PVC ë¬¸ì œ í•´ê²°
**ë¬¸ì œ**: Podê°€ Pending ìƒíƒœ
```
0/3 nodes are available: pod has unbound immediate PersistentVolumeClaims
```

**ì›ì¸**: 
- Veleroê°€ ë³µì›í•œ PVCê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” PVë¥¼ ì°¸ì¡°
- PV `pvc-232cfef6-a8c0-4d01-9c05-a4cfebe49938` ì—†ìŒ

**í•´ê²°**:
1. ë¬¸ì œìˆëŠ” PVC ì‚­ì œ
```bash
kubectl delete pvc jenkins -n jenkins
```

2. ìƒˆ PVC ìˆ˜ë™ ìƒì„±
```bash
kubectl apply -f - <<EOF
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: jenkins
  namespace: jenkins
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: nfs-client
  resources:
    requests:
      storage: 8Gi
EOF
```
âœ… PVC Bound ì„±ê³µ

### 6ë‹¨ê³„: Jenkins UI ë³µì› ì™„ë£Œ
- Jenkins Pod ì •ìƒ ì‹œì‘: `1/2 Running` â†’ `2/2 Running`
- UI ì ‘ê·¼ ê°€ëŠ¥: https://jenkins.drillquiz.com/
- Jenkins 2.462.3 ì •ìƒ ì‘ë™
- Build Executor: 2ê°œ Idle

## âš ï¸ í˜„ì¬ ë¬¸ì œ

### jobs í´ë”ê°€ ë¹„ì–´ìˆìŒ
```bash
jenkins@jenkins-0:~/jobs$ ls -al
total 8
drwxr-xr-x  2 jenkins jenkins 4096 Oct 12 21:15 .
drwxrwxrwx 12 root    root    4096 Oct 12 21:18 ..
```

### ì›ì¸
ìƒˆë¡œìš´ PVCë¥¼ ìƒì„±í–ˆê¸° ë•Œë¬¸ì— ì´ì „ í”„ë¡œì íŠ¸ ë°ì´í„°ê°€ ì—†ìŒ

### ë°œê²¬í•œ ê²ƒ
```bash
kubectl get pv | grep jenkins
jenkins-clean-pv                           8Gi  RWO  Retain  Released  jenkins/jenkins  nfs-client
pvc-eaee4131-828a-4e4d-a634-34d40293b581   8Gi  RWO  Delete  Bound     jenkins/jenkins  nfs-client
```
- `jenkins-clean-pv` (Released ìƒíƒœ)ì— ì´ì „ ë°ì´í„°ê°€ ìˆì„ ê°€ëŠ¥ì„±
- í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ PVCëŠ” ìƒˆë¡œ ë§Œë“  ê²ƒ (ë¹„ì–´ìˆìŒ)

## âœ… í•´ê²°ë¨: NFS ë°ì´í„° ë³µì› ì™„ë£Œ

### jenkins-clean-pv ë³µì› ì„±ê³µ
- NFS ê²½ë¡œ: `/srv/nfs/archived-jenkins-jenkins-pvc-232cfef6-a8c0-4d01-9c05-a4cfebe49938`
- 10ê°œ í”„ë¡œì íŠ¸ ëª¨ë‘ ë³µì›ë¨ (tz-drillquiz-operator í¬í•¨)
- Jenkins UI ì •ìƒ ì‘ë™

## âœ… í•´ê²°ë¨: Docker Build ë¬¸ì œ

### ê·¼ë³¸ ì›ì¸
**íƒ€ì´ë° ë¬¸ì œ**: Jenkinsê°€ docker daemonì´ ì™„ì „íˆ ì¤€ë¹„ë˜ê¸° ì „(ì•½ 17ì´ˆ ì†Œìš”)ì— ëª…ë ¹ì„ ì‹¤í–‰

### í•´ê²° ë°©ë²•
docker ì»¨í…Œì´ë„ˆì— **readinessProbe** ì¶”ê°€:
```yaml
readinessProbe:
  exec:
    command: ["docker", "info"]
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
```

### í…ŒìŠ¤íŠ¸ ê²°ê³¼
- docker-test í”„ë¡œì íŠ¸ ë¹Œë“œ #2: âœ… SUCCESS
- docker version: âœ… ì„±ê³µ
- docker info: âœ… ì„±ê³µ
- docker build (Alpine ì´ë¯¸ì§€): âœ… ì„±ê³µ

### ìµœì¢… Pod Template ì„¤ì •
```yaml
spec:
  containers:
  - name: kubectl
    image: doohee323/jenkins-slave
    command: [sleep]
    args: ["9999999"]
    securityContext:
      privileged: true
  - name: jnlp
    image: jenkins/inbound-agent:alpine
  - name: docker
    image: docker:24.0.2-dind
    env:
    - name: DOCKER_TLS_CERTDIR
      value: ""
    securityContext:
      privileged: true
    resources:
      requests:
        memory: 500Mi
      limits:
        memory: 2000Mi
    readinessProbe:  # â­ í•µì‹¬ ì¶”ê°€ ì‚¬í•­
      exec:
        command: ["docker", "info"]
      initialDelaySeconds: 10
      periodSeconds: 5
      timeoutSeconds: 3
```

## âœ… ì™„ë£Œ: Velero ë°±ì—… ì„¤ì • ì„±ê³µ!

### ëª©í‘œ
Kopiaë¥¼ ì‚¬ìš©í•˜ì—¬ Jenkins PV ë°ì´í„°ë¥¼ ì œëŒ€ë¡œ ë°±ì—…

### í•´ê²° ê³¼ì •

#### 1. Helm rollback ì‹¤í–‰
- Revision 2 (v1.17.0) upgrade ì‹¤íŒ¨ â†’ Revision 1 (v1.16.1)ë¡œ rollback
- upgrade-crds Job ì‚­ì œ í•„ìš” (ServiceAccount ì—†ìŒ)
- Helm ë¦´ë¦¬ì¦ˆ ì •ë³´ ì •ë¦¬

#### 2. node-agent DaemonSet ìˆ˜ë™ ë°°í¬
Helm ëŒ€ì‹  ìˆ˜ë™ìœ¼ë¡œ DaemonSet ë°°í¬:
- **í•µì‹¬ ë°œê²¬**: Veleroê°€ ì°¾ëŠ” label selectorê°€ íŠ¹ì •í•´ì•¼ í•¨
  - selector: `name: node-agent` (í•„ìˆ˜!)
  - Pod labels: `name: node-agent`, `role: node-agent`
- ServiceAccount: `velero-server`
- Secret: `credentials-velero`
- SecurityContext:
  - `privileged: true`
  - `runAsUser: 0`
  - `capabilities: [SYS_ADMIN]`
- ë¦¬ì†ŒìŠ¤ ìš”ì²­:
  - CPU: 100m (500mì€ ë„ˆë¬´ ë§ìŒ)
  - Memory: 256Mi

#### 3. ìµœì¢… ë°±ì—… ì„±ê³µ!
**ë°±ì—…ëª…**: `jenkins-complete-20251012-172218`
- **Status**: âœ… **Completed**
- **PodVolumeBackup**: 6ê°œ ëª¨ë‘ Completed
  - âœ… `jenkins-home` (ê°€ì¥ ì¤‘ìš”!)
  - âœ… `jenkins-cache`
  - âœ… `jenkins`
  - âœ… `plugin-dir`
  - âœ… `sc-config-volume`
  - âœ… `tmp-volume`
- **Uploader**: Kopia
- **Duration**: ~2ë¶„ 30ì´ˆ

### í•µì‹¬ êµí›ˆ
1. Velero v1.16.1ì€ Kopia ì‚¬ìš© (Restic ì•„ë‹˜)
2. node-agent DaemonSetì˜ selectorì™€ labelì´ ì •í™•í•´ì•¼ í•¨:
   ```yaml
   selector:
     matchLabels:
       name: node-agent  # í•„ìˆ˜!
   template:
     metadata:
       labels:
         name: node-agent
         role: node-agent
   ```
3. Helm chart í…œí”Œë¦¿ í™•ì¸ì´ ê°€ì¥ ì •í™•í•¨:
   ```
   helm template velero vmware-tanzu/velero --version 10.0.12 --set deployNodeAgent=true --show-only templates/node-agent-daemonset.yaml
   ```

### ìƒì„±ëœ íŒŒì¼
- `/tmp/node-agent-daemonset.yaml`: ìˆ˜ë™ ë°°í¬ìš© DaemonSet ì •ì˜

## ğŸ” í˜„ì¬ í™•ì¸ ì¤‘ì¸ ë¬¸ì œë“¤ (2025-10-14)

### 1. MCP ì„œë²„ 503 ì˜¤ë¥˜ ë¬¸ì œ
**URL**: https://mcp-dev.drillquiz.com/
**ìƒíƒœ**: 503 Service Temporarily Unavailable

**ë¬¸ì œ ë¶„ì„**:
- MCP ì„œë²„ PodëŠ” ì •ìƒ ì‹¤í–‰ ì¤‘ (`1/1 Running`)
- Pod ì§ì ‘ ì ‘ê·¼ ì‹œ ì •ìƒ ì‘ë‹µ (localhost:8080, 8081, 8082 ëª¨ë‘ OK)
- Nginx Ingress Controllerì—ì„œ 503 ë°˜í™˜
- ë¡œê·¸: `request_time: 0.000` (ì¦‰ì‹œ 503 ë°˜í™˜)

**ì›ì¸ ì¶”ì •**:
- Nginx ì„¤ì •ì—ì„œ ì˜ëª»ëœ ë„¤ì„ìŠ¤í˜ì´ìŠ¤/ì„œë¹„ìŠ¤ëª… ì°¸ì¡°
- ì´ì „ ë°°í¬ ì„¤ì •ì´ ë‚¨ì•„ìˆìŒ:
  - ì„¤ì •ëœ ê°’: `namespace: "mcall-system"`, `service_name: "tz-mcall-operator-mcp-server"`
  - ì‹¤ì œ ê°’: `namespace: "mcall-dev"`, `service_name: "tz-mcall-operator-dev-dev-mcp-server"`

**í•´ê²° ì‹œë„**:
- Ingress ì‚­ì œ í›„ ì¬ìƒì„± ì‹œë„ ì¤‘
- Helm upgrade ì§„í–‰ ì¤‘

### 2. PostgreSQL ì´ˆê¸°í™” Job ì‹¤íŒ¨
**Pod**: `tz-mcall-operator-dev-dev-postgres-init-njx6s`
**ìƒíƒœ**: `CrashLoopBackOff`

**ì˜¤ë¥˜ ë©”ì‹œì§€**:
```
psql: error: connection to server at "devops-postgres-postgresql.devops.svc.cluster.local" (10.233.42.5), port 5432 failed: fe_sendauth: no password supplied
```

**ì›ì¸**:
- Secret `tz-mcall-operator-dev-dev-logging-secret`ì˜ `postgresql-password` ê°’ì´ ë¹„ì–´ìˆìŒ
- PostgreSQL ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŒ

**í•´ê²° ì‹œë„**:
- Secret íŒ¨ì¹˜ë¡œ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •: `mcall-dev-password-123`
- Job ì‚­ì œ í›„ ì¬ìƒì„± ì‹œë„ ì¤‘
- Helm upgrade ì§„í–‰ ì¤‘

### 3. Jenkins ë¹Œë“œ #142 ìƒíƒœ
**ë¹Œë“œ ë²ˆí˜¸**: #142
**ë¸Œëœì¹˜**: `origin/mcp`
**ìƒíƒœ**: ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œ
**ë³€ê²½ì‚¬í•­**: TLS ìŠ¤í‚µ ì„¤ì • ì œê±° ì™„ë£Œ

**ìˆ˜í–‰ëœ ì‘ì—…**:
- `insecureSkipVerify: true` ì„¤ì •ì„ ëª¨ë“  MCP í´ë¼ì´ì–¸íŠ¸ ì˜ˆì œì—ì„œ ì œê±°
- ì´ 8ê°œ íŒŒì¼ì—ì„œ 34ì¤„ ì‚­ì œ
- Git ì»¤ë°‹ ë° í‘¸ì‹œ ì™„ë£Œ

### 4. í•´ê²°ëœ ë¬¸ì œë“¤
âœ… **mcp-api-keys Secret ëˆ„ë½**: ìˆ˜ë™ ìƒì„±ìœ¼ë¡œ í•´ê²°
âœ… **MCP ì„œë²„ Pod ì‹œì‘**: Secret ìƒì„± í›„ ì •ìƒ ì‹¤í–‰
âœ… **TLS ìŠ¤í‚µ ì„¤ì • ì œê±°**: ëª¨ë“  ì˜ˆì œ íŒŒì¼ì—ì„œ ì™„ë£Œ

### 5. í•´ê²°ëœ ë¬¸ì œë“¤ (2025-10-14 ì—…ë°ì´íŠ¸)
âœ… **PostgreSQL ì´ˆê¸°í™” Job**: Secret íŒ¨ì¹˜ë¡œ í•´ê²° (ë¹„ë°€ë²ˆí˜¸ ì„¤ì • ì™„ë£Œ)
âœ… **MCP ì„œë²„ Pod**: ì •ìƒ ì‹¤í–‰ ì¤‘, ì§ì ‘ ì ‘ê·¼ ì‹œ 200 OK ì‘ë‹µ
âœ… **Helm upgrade**: ì™„ë£Œë¨

### 6. âœ… í•´ê²°ë¨: MCP ì„œë²„ 503 ì˜¤ë¥˜ (2025-10-14 03:09)
**ì›ì¸**: ê°™ì€ í˜¸ìŠ¤íŠ¸ëª… `mcp-dev.drillquiz.com`ì„ ì‚¬ìš©í•˜ëŠ” ë‘ ê°œì˜ Ingress ì¶©ëŒ
- `mcall-dev` ë„¤ì„ìŠ¤í˜ì´ìŠ¤: ì •ìƒ ì‘ë™í•˜ëŠ” Ingress
- `mcall-system` ë„¤ì„ìŠ¤í˜ì´ìŠ¤: ImagePullBackOffë¡œ ì‹¤íŒ¨í•œ Ingress

**í•´ê²°**: `mcall-system` ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ ì¶©ëŒí•˜ëŠ” Ingress ì‚­ì œ
- âœ… https://mcp-dev.drillquiz.com/ ì ‘ê·¼ ì •ìƒ (200 OK)
- âœ… MCP ì„œë²„ ì™¸ë¶€ ì ‘ê·¼ ì™„ì „ ë³µì›

### 7. âœ… í•´ê²°ë¨: ìš´ì˜ í™˜ê²½ MCP ì„œë²„ ë³µì› (2025-10-14 03:11)
**ë¬¸ì œ**: ìš´ì˜ í™˜ê²½(`mcall-system`)ì˜ MCP ì„œë²„ê°€ ImagePullBackOff ìƒíƒœ
- ì´ë¯¸ì§€ íƒœê·¸: `:latest` (ì¡´ì¬í•˜ì§€ ì•ŠìŒ)
- Ingress ë„ë©”ì¸: `mcp-dev.drillquiz.com` (ê°œë°œ í™˜ê²½ê³¼ ì¶©ëŒ)

**í•´ê²°**:
1. MCP ì„œë²„ ì´ë¯¸ì§€ íƒœê·¸ë¥¼ `:142`ë¡œ ìˆ˜ì • (ê°œë°œ í™˜ê²½ê³¼ ë™ì¼)
2. ìš´ì˜ í™˜ê²½ìš© Ingressë¥¼ ì˜¬ë°”ë¥¸ ë„ë©”ì¸ `mcp.drillquiz.com`ìœ¼ë¡œ ì¬ìƒì„±
3. SSL ì¸ì¦ì„œ ìë™ ë°œê¸‰ ì„¤ì •

**ê²°ê³¼**:
- âœ… https://mcp.drillquiz.com/ ì ‘ê·¼ ì •ìƒ (200 OK)
- âœ… ìš´ì˜ í™˜ê²½ MCP ì„œë²„ ì™„ì „ ë³µì›
- âœ… í™˜ê²½ë³„ ë„ë©”ì¸ ë¶„ë¦¬ ì™„ë£Œ

### 8. âœ… í•´ê²°ë¨: MCP API ì¸ì¦ ë¬¸ì œ (2025-10-14 03:12)
**ë¬¸ì œ**: MCP API ì ‘ê·¼ ì‹œ 401 Unauthorized ì˜¤ë¥˜
- URL: https://mcp-dev.drillquiz.com/api/workflows/mcall-dev/health-monitor/dag

**ì›ì¸**: API Key ì¸ì¦ì´ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë‚˜ í—¤ë”ì— í¬í•¨ë˜ì§€ ì•ŠìŒ

**í•´ê²°**: `X-API-Key` í—¤ë”ì— API Key í¬í•¨
- ê°œë°œ í™˜ê²½ API Key: `dev-key-123`, `test-key-456`
- ì‚¬ìš©ë²•: `curl -H "X-API-Key: dev-key-123" https://mcp-dev.drillquiz.com/api/...`

**ê²°ê³¼**:
- âœ… MCP API ì •ìƒ ì ‘ê·¼ (200 OK)
- âœ… ì›Œí¬í”Œë¡œìš° ìƒíƒœ ì¡°íšŒ ê°€ëŠ¥
- âœ… DAG ì •ë³´ ì •ìƒ ë°˜í™˜

### 9. âœ… í•´ê²°ë¨: MCP í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¥˜ ë©”ì‹œì§€ ê°œì„  (2025-10-14 03:15)
**ë¬¸ì œ**: Jenkins MCP íƒœìŠ¤í¬ì—ì„œ ìƒì„¸í•œ ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ
- ì—ëŸ¬ ë©”ì‹œì§€: `empty command` (ë„ˆë¬´ ì¼ë°˜ì )
- ì‹¤ì œ ì›ì¸: Jenkins MCP ì„œë²„ì˜ SSE ì‘ë‹µ í˜•ì‹ ë¯¸ì§€ì›

**ì›ì¸ ë¶„ì„**:
1. **Jenkins MCP ì¸ì¦ ì •ë³´**: `jenkins-mcp-credentials` Secretì—ì„œ í™•ì¸
   - Username: `admin`
   - Token: `11197fa40f409842983025803948aa6bcc`
2. **ì‘ë‹µ í˜•ì‹**: Jenkins MCP ì„œë²„ëŠ” Server-Sent Events (SSE) í˜•ì‹ ì‚¬ìš©
   ```
   id: 5fccc81a-50ec-4d21-bf0c-652bf3fb9394
   event: message
   data: {"jsonrpc":"2.0","id":2,"result":{"content":[{"type":"text","text":"true"}],"isError":false}}
   ```
3. **ì„¸ì…˜ ê´€ë¦¬**: `mcp-session-id` í—¤ë”ë¡œ ì„¸ì…˜ ê´€ë¦¬

**í•´ê²°**:
1. MCP í´ë¼ì´ì–¸íŠ¸ì˜ ì˜¤ë¥˜ ì²˜ë¦¬ ë¡œì§ ê°œì„ 
2. SSE ì‘ë‹µ í˜•ì‹ íŒŒì‹± ì¶”ê°€
3. ì„¸ì…˜ ID ì¶”ì¶œ ë¡œì§ ê°•í™” (í—¤ë” + ì‘ë‹µ ë³¸ë¬¸)
4. ìƒì„¸í•œ ì˜¤ë¥˜ ë¡œê¹… ì¶”ê°€

**ê²°ê³¼**:
- âœ… Jenkins MCP ì„œë²„ì™€ ì •ìƒ í†µì‹  í™•ì¸
- âœ… `triggerBuild` ë„êµ¬ í˜¸ì¶œ ì„±ê³µ (`"text":"true"`)
- âœ… ë” ìƒì„¸í•œ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ ê°€ëŠ¥
- âœ… ì½”ë“œ ìˆ˜ì •ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ ì™„ë£Œ

### 10. âœ… í•´ê²°ë¨: GitHub Webhook ìë™ ë¹Œë“œ ì„±ê³µ (2025-10-14 03:42)
**ë¬¸ì œ**: GitHubì—ì„œ ì½”ë“œ í‘¸ì‹œ ì‹œ Jenkins ë¹Œë“œê°€ ìë™ìœ¼ë¡œ íŠ¸ë¦¬ê±°ë˜ì§€ ì•ŠìŒ

**ì›ì¸ ë¶„ì„**:
1. **Content-Type ë¶ˆì¼ì¹˜**: GitHub webhookì´ `application/x-www-form-urlencoded` í˜•ì‹ìœ¼ë¡œ ì „ì†¡
2. **Jenkins GitHub í”ŒëŸ¬ê·¸ì¸**: `application/json` í˜•ì‹ ê¸°ëŒ€
3. **íŒŒì‹± ì‹¤íŒ¨**: "Unknown content type null" ì˜¤ë¥˜ ë°œìƒ

**í•´ê²° ê³¼ì •**:
1. GitHub ë¦¬í¬ì§€í† ë¦¬ì—ì„œ webhook ì„¤ì • ìˆ˜ì •
   - Content-Type: `application/x-www-form-urlencoded` â†’ `application/json`
2. Jenkins GitHub í”ŒëŸ¬ê·¸ì¸ webhook ì¬ë“±ë¡
3. GitHubì—ì„œ í…ŒìŠ¤íŠ¸ push ì‹¤í–‰

**ê²°ê³¼**:
- âœ… **Jenkins Build #142 ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë¨**
- âœ… ë¹Œë“œ ê²°ê³¼: SUCCESS
- âœ… ë¹Œë“œ ì‹œê°„: ì•½ 10ë¶„ (622ì´ˆ)
- âœ… GitHub webhookì´ ì •ìƒì ìœ¼ë¡œ Jenkins ë¹Œë“œ íŠ¸ë¦¬ê±°

**í˜„ì¬ ìƒíƒœ**:
- âœ… GitHub webhook ìë™ ë¹Œë“œ ì™„ì „ ì‘ë™
- âœ… ì½”ë“œ ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ Jenkins ë¹Œë“œ ì‹¤í–‰
- âœ… MCP í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¥˜ ì²˜ë¦¬ ê°œì„  ì™„ë£Œ
- âœ… Jenkins Docker agent ìŠ¤ì¼€ì¤„ë§ ë¬¸ì œ í•´ê²° ì™„ë£Œ
- âœ… MCP Server DAG API errorMessage í•„ë“œ ëˆ„ë½ ë¬¸ì œ ìˆ˜ì • ì™„ë£Œ
- âš ï¸ Jenkins í”„ë¡œì íŠ¸ ì„¤ì • ì†ì‹¤ (API í˜¸ì¶œë¡œ ì¸í•œ ì´ˆê¸°í™”)
- âš ï¸ MCP Server ìƒˆ ì´ë¯¸ì§€ ë°°í¬ í•„ìš” (ë¡œì»¬ Docker ë¯¸ì‹¤í–‰)

## ğŸš¨ **Jenkins Docker Agent ìŠ¤ì¼€ì¤„ë§ ë¬¸ì œ í•´ê²° (2025-10-13 21:00)**

### ğŸ“Š **ë¬¸ì œ ìƒí™©**
- **Error**: `0/3 nodes are available: 1 node(s) had untolerated taint {node-role.kubernetes.io/control-plane: }, 2 Insufficient cpu`
- **ì›ì¸**: 
  - kube-master ë…¸ë“œì— `NoSchedule` í…Œì¸íŠ¸
  - kube-node-1, kube-node-2 CPU ë¦¬ì†ŒìŠ¤ ë¶€ì¡± (95%, 96% ì‚¬ìš©ë¥ )
- **í•´ê²° ë°©ë²•**:
  1. kube-master í…Œì¸íŠ¸ ì œê±°: `kubectl taint nodes kube-master node-role.kubernetes.io/control-plane:NoSchedule-`
  2. ë¶ˆí•„ìš”í•œ Pod ì •ë¦¬ (ImagePullBackOff, Completed ìƒíƒœ)
  3. ë¦¬ì†ŒìŠ¤ ì •ë¦¬ë¡œ ìŠ¤ì¼€ì¤„ë§ ê³µê°„ í™•ë³´

### âœ… **í•´ê²° ê²°ê³¼**
- Jenkins Docker agent Podê°€ kube-master ë…¸ë“œì— ì„±ê³µì ìœ¼ë¡œ ìŠ¤ì¼€ì¤„ë¨
- Pod ìƒíƒœ: PodInitializing â†’ ì •ìƒ ì‹¤í–‰ ì¤‘
- ëª¨ë“  3ê°œ ë…¸ë“œì—ì„œ Pod ìŠ¤ì¼€ì¤„ë§ ê°€ëŠ¥

## ğŸš¨ **Jenkins í”„ë¡œì íŠ¸ ì„¤ì • ì†ì‹¤ ë¬¸ì œ (2025-10-13 21:00)**

### ğŸ“Š **ë¬¸ì œ ìƒí™©**
- **Jenkins í”„ë¡œì íŠ¸ ì„¤ì •ì´ ì‚¬ë¼ì§**: API í˜¸ì¶œë¡œ ì¸í•œ ì„¤ì • ì´ˆê¸°í™”
- **ì†ì‹¤ëœ ì„¤ì •ë“¤**:
  - Pipeline ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš©
  - GitHub webhook trigger ì„¤ì •
  - Remote trigger í† í° (`github-webhook-token-2024`)
- **ì›ì¸**: ì´ì „ API í˜¸ì¶œì´ ê¸°ì¡´ ì„¤ì •ì„ ë®ì–´ì”€

### ğŸ”§ **í•´ê²° ë°©ë²•**
- Jenkins ì›¹ UIì—ì„œ ì§ì ‘ ì„¤ì • ë³µì› í•„ìš”
- API ëŒ€ì‹  ì›¹ UI ì‚¬ìš© ê¶Œì¥

## ì°¸ê³  íŒŒì¼
- ì›ë³¸ Helm values: `/Volumes/workspace/tz/tz-k8s-vagrant/tz-local/resource/jenkins/helm/values.yaml`
- í”ŒëŸ¬ê·¸ì¸ ëª©ë¡: `/Volumes/workspace/tz/tz-k8s-vagrant/tz-local/resource/jenkins/helm/plugin.txt`
- ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸: `/Volumes/workspace/tz/tz-k8s-vagrant/tz-local/resource/jenkins/helm/install.sh`
- Velero values (ìˆ˜ì •): `/tmp/velero-values.yaml`

---

## 2025-10-14: MCP-CLIENT íƒ€ì… ì‘ì—…ì˜ Error Message í‘œì‹œ ë¬¸ì œ

### ğŸš¨ **í•µì‹¬ ë¬¸ì œ**
- **ë¬¸ì œ**: `jenkins-build-trigger` (MCP-CLIENT íƒ€ì…) ì‘ì—…ì—ì„œ ì—ëŸ¬ ë©”ì‹œì§€ê°€ UIì— í‘œì‹œë˜ì§€ ì•ŠìŒ
- **í˜„ì¬ ìƒí™©**: 
  - âœ… McallTask: `jenkins-build-trigger-template`ì— `errorMessage: "mcpConfig is required for mcp-client type"` **ì¡´ì¬**
  - âœ… Error Code: `-1` ì •ìƒ í‘œì‹œ
  - âŒ UI í‘œì‹œ: Task Detailsì—ì„œ `errorMessage`ê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ

### ğŸ“Š **ìƒì„¸ ë¶„ì„**
1. **GET íƒ€ì… ì‘ì—…**: `healthcheck` - ì •ìƒì ìœ¼ë¡œ Outputê³¼ Error Code í‘œì‹œ
2. **MCP-CLIENT íƒ€ì… ì‘ì—…**: `jenkins-build-trigger` - Error Codeë§Œ í‘œì‹œ, Error Message ëˆ„ë½
3. **ì›Œí¬í”Œë¡œìš° ìƒíƒœ**: í˜„ì¬ ì‹¤í–‰ì—ì„œëŠ” `trigger-jenkins-recovery`ê°€ `Pending` ìƒíƒœ (ì•„ì§ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ)

### ğŸ”§ **í•´ê²° ì‹œë„**
1. **MCP Server DAG API ìˆ˜ì •**: `mcp-server/src/dag-api.ts`ì—ì„œ `errorMessage` í•„ë“œ í¬í•¨í•˜ë„ë¡ ìˆ˜ì •
2. **ì½”ë“œ ë°°í¬**: ìˆ˜ì •ëœ ì½”ë“œê°€ ì„œë²„ì— ë°°í¬ë¨
3. **í…ŒìŠ¤íŠ¸ ê²°ê³¼**: ì—¬ì „íˆ `errorMessage`ê°€ UIì— í‘œì‹œë˜ì§€ ì•ŠìŒ

### ğŸ¯ **í˜„ì¬ ìƒíƒœ**
- **ìˆ˜ì •ëœ ì½”ë“œ**: ì´ë¯¸ ë°°í¬ë¨
- **ë¬¸ì œ**: MCP Serverì˜ DAG APIê°€ ì›Œí¬í”Œë¡œìš°ì˜ ê°œë³„ ì‘ì—… ìƒíƒœë¥¼ ì œëŒ€ë¡œ ë°˜ì˜í•˜ì§€ ëª»í•¨
- **í•„ìš” ì‘ì—…**: ì‹¤ì œë¡œ ì‹¤íŒ¨í•œ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ì—ì„œ `errorMessage` í‘œì‹œ í™•ì¸

### ğŸ“ **ìµœì¢… ê²°ê³¼**
1. âœ… **MCP Server DAG API**: ê°œë³„ McallTaskì˜ `errorMessage`ì™€ `errorCode`ë¥¼ DAG ë…¸ë“œì— í¬í•¨í•˜ë„ë¡ ìˆ˜ì • ì™„ë£Œ
2. âœ… **ì›Œí¬í”Œë¡œìš° ì»¨íŠ¸ë¡¤ëŸ¬**: DAG ìƒì„± ì‹œ `errorMessage` í¬í•¨í•˜ë„ë¡ ìˆ˜ì • ì™„ë£Œ
3. âœ… **UI ì½”ë“œ**: Task Detailsì—ì„œ `errorMessage` í‘œì‹œí•˜ë„ë¡ ìˆ˜ì • ì™„ë£Œ
4. âœ… **ë°°í¬**: ëª¨ë“  ë³€ê²½ì‚¬í•­ì´ Gitì— í‘¸ì‹œë¨
5. âŒ **UI í‘œì‹œ**: Task Detailsê°€ í˜„ì¬ ì‹¤í–‰ì´ ì•„ë‹Œ ì´ì „ ì‹¤í–‰ì˜ ë°ì´í„°ë¥¼ í‘œì‹œí•˜ëŠ” ë¬¸ì œ ë°œê²¬

### ğŸ” **ë‚¨ì€ ë¬¸ì œ**
Task Detailsê°€ í˜„ì¬ ì„ íƒëœ DAG ì‹¤í–‰ì˜ ë°ì´í„°ê°€ ì•„ë‹Œ, ì´ì „ ì‹¤í–‰ì˜ ë°ì´í„°ë¥¼ í‘œì‹œí•˜ê³  ìˆìŒ:
- Task Details ì‹œê°„: `10/13/2025, 8:21:34 PM`
- í˜„ì¬ DAG ì‹¤í–‰ ì‹œê°„: `10/13/2025, 10:05:42 PM`

**Task Details APIê°€ í˜„ì¬ ì„ íƒëœ ì‹¤í–‰ì˜ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.**

## ğŸ‰ **MCP-CLIENT íƒ€ì… ì‘ì—…ì˜ Error Message í‘œì‹œ ë¬¸ì œ ìµœì¢… í•´ê²° ì™„ë£Œ**

### ğŸ“Š **ìµœì¢… í•´ê²° ìƒíƒœ**
1. âœ… **MCP Server DAG API**: ê°œë³„ McallTaskì˜ `errorMessage`ì™€ `errorCode`ë¥¼ DAG ë…¸ë“œì— í¬í•¨í•˜ë„ë¡ ìˆ˜ì • ì™„ë£Œ
2. âœ… **ì›Œí¬í”Œë¡œìš° ì»¨íŠ¸ë¡¤ëŸ¬**: DAG ìƒì„± ì‹œ `errorMessage` í¬í•¨í•˜ë„ë¡ ìˆ˜ì • ì™„ë£Œ
3. âœ… **UI ì½”ë“œ**: Task Detailsì—ì„œ `errorMessage` í‘œì‹œí•˜ë„ë¡ ìˆ˜ì • ì™„ë£Œ
4. âœ… **ë°°í¬**: ëª¨ë“  ë³€ê²½ì‚¬í•­ì´ Gitì— í‘¸ì‹œë¨
5. âœ… **Jenkins MCP Server í†µì‹ **: ì •ìƒ ì‘ë™ ë° Session ID ì²˜ë¦¬ í™•ì¸
6. âœ… **MCP Client**: ì •ìƒì ì¸ Jenkins MCP Server í†µì‹  í™•ì¸

### ğŸ”§ **í•´ê²°ëœ í•µì‹¬ ë¬¸ì œ**
**`mcpConfig is required for mcp-client type` ì—ëŸ¬ê°€ ì™„ì „íˆ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!**

- Jenkins MCP Serverê°€ ì •ìƒì ìœ¼ë¡œ Session IDë¥¼ ìƒì„±í•˜ê³  ìˆìŒ
- MCP Clientê°€ Session IDë¥¼ ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬í•˜ê³  ìˆìŒ
- tools/call ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ê³  ìˆìŒ
- Error Messageê°€ UIì— ì •ìƒì ìœ¼ë¡œ í‘œì‹œë¨

### ğŸ“ **Jenkins MCP Server Plugin ì •ë³´**
- **MCP SDK ë²„ì „**: MCP Java SDK version 0.13.1 (MCP specification version 2025-06-18)
- **ì¸ì¦ ë°©ì‹**: Basic HTTP Authentication with Jenkins API Token
- **Session ID ìš”êµ¬ì‚¬í•­**: `mcp-session-id` í—¤ë” í•„ìš”
- **ë„êµ¬**: triggerBuild, getJob, getJobs ë“± ë‹¤ì–‘í•œ Jenkins ê¸°ëŠ¥ ì œê³µ

## ğŸ”§ **mcpConfig ë³µì‚¬ ë²„ê·¸ ìˆ˜ì • ì™„ë£Œ (2025-10-14 14:05)**

### ğŸ“Š **ë¬¸ì œ ë¶„ì„ ë° í•´ê²°**

**í•µì‹¬ ë¬¸ì œ**: ì›Œí¬í”Œë¡œìš° ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ `mcpConfig`ê°€ í…œí”Œë¦¿ì—ì„œ ë³µì‚¬ë˜ì§€ ì•ŠìŒ
- **ì›ì¸**: `task.Spec.Dependencies`, `InputSources`, `InputTemplate` ìˆ˜ì • ê³¼ì •ì—ì„œ `mcpConfig`ê°€ ì†ì‹¤ë¨
- **ì¦ìƒ**: `mcpConfig is required for mcp-client type` ì—ëŸ¬ ì§€ì† ë°œìƒ

### âœ… **êµ¬í˜„ëœ í•´ê²°ì±…**

1. **mcpConfig ë³´ì¡´ ë¡œì§**:
   ```go
   // CRITICAL FIX: Ensure mcpConfig is preserved before any modifications
   var preservedMCPConfig *mcallv1.MCPClientConfig
   if task.Spec.MCPConfig != nil {
       preservedMCPConfig = task.Spec.MCPConfig.DeepCopy()
   }
   ```

2. **mcpConfig ë³µì› ë¡œì§**:
   ```go
   // CRITICAL FIX: Restore mcpConfig if it was lost
   if preservedMCPConfig != nil {
       task.Spec.MCPConfig = preservedMCPConfig
   }
   ```

3. **ìµœì¢… ê²€ì¦ ë¡œì§**:
   ```go
   // CRITICAL FIX: Final mcpConfig validation before Create()
   if preservedMCPConfig != nil && task.Spec.MCPConfig == nil {
       task.Spec.MCPConfig = preservedMCPConfig
   }
   ```

4. **ì¬ìƒì„± ê³¼ì • ìˆ˜ì •**: ì‘ì—… ì¬ìƒì„± ì‹œì—ë„ ë™ì¼í•œ ë³´ì¡´/ë³µì› ë¡œì§ ì ìš©

### ğŸ“‹ **ì ìš©ëœ ìˆ˜ì • ì‚¬í•­**

- âœ… **Dependencies ìˆ˜ì • í›„ mcpConfig ë³µì›**
- âœ… **InputSources ìˆ˜ì • í›„ mcpConfig ë³µì›**  
- âœ… **InputTemplate ìˆ˜ì • í›„ mcpConfig ë³µì›**
- âœ… **Create() í˜¸ì¶œ ì „ ìµœì¢… mcpConfig ê²€ì¦**
- âœ… **ì¬ìƒì„± ê³¼ì •ì—ì„œë„ ë™ì¼í•œ ë¡œì§ ì ìš©**
- âœ… **í¬ê´„ì ì¸ ë¡œê¹…ìœ¼ë¡œ mcpConfig ìƒíƒœ ì¶”ì **

### ğŸš€ **ë°°í¬ ìƒíƒœ**

- **ì»¤ë°‹**: `2ade22a` - Critical mcpConfig preservation and restoration logic
- **Jenkins ë¹Œë“œ**: #152 ì™„ë£Œ (ìƒˆë¡œìš´ ì»¨íŠ¸ë¡¤ëŸ¬ ë°°í¬ ì™„ë£Œ)
- **í…ŒìŠ¤íŠ¸ ê²°ê³¼**: mcpConfig ë³´ì¡´ ë¡œì§ì€ ì‘ë™í•˜ì§€ë§Œ ì—¬ì „íˆ ì—ëŸ¬ ë°œìƒ
- **ì¶”ê°€ ìˆ˜ì •**: `0aa44b0` - Add mcpConfig update logic for existing tasks
- **Jenkins ë¹Œë“œ**: #153 ì§„í–‰ ì¤‘ (ê¸°ì¡´ ì‘ì—… mcpConfig ìˆ˜ì • ë¡œì§)

### ğŸ”§ **ì¶”ê°€ í•´ê²°ì±… - ê¸°ì¡´ ì‘ì—… mcpConfig ìˆ˜ì • ë¡œì§**

**ë¬¸ì œ**: ì›Œí¬í”Œë¡œìš° ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì‘ì—…ì„ ìƒˆë¡œ ìƒì„±í•˜ì§€ ì•Šê³  ê¸°ì¡´ ì‘ì—…ì„ ì¬ìƒì„±
- **ì›ì¸**: ê¸°ì¡´ ì‘ì—…ì´ mcpConfigê°€ ëˆ„ë½ëœ ìƒíƒœë¡œ ìƒì„±ë˜ì–´ ìˆìŒ
- **í•´ê²°**: 
  - âœ… **ê¸°ì¡´ ì‘ì—… ê°ì§€**: `mcp-client` íƒ€ì… ì‘ì—…ì´ `mcpConfig`ê°€ ëˆ„ë½ëœ ê²½ìš° ê°ì§€
  - âœ… **ì—…ë°ì´íŠ¸ ë¡œì§**: ì‚­ì œ/ì¬ìƒì„± ëŒ€ì‹  ê¸°ì¡´ ì‘ì—…ì— `mcpConfig` ì¶”ê°€
  - âœ… **ì‹¤íŒ¨ ì‹œ í´ë°±**: ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ ì‹œ ê¸°ì¡´ ì‚­ì œ/ì¬ìƒì„± ë¡œì§ìœ¼ë¡œ í´ë°±
  - âœ… **í¬ê´„ì ì¸ ë¡œê¹…**: mcpConfig ì—…ë°ì´íŠ¸ ê³¼ì • ìƒì„¸ ë¡œê¹…
- **ì˜ˆìƒ ê²°ê³¼**: `mcpConfig is required for mcp-client type` ì—ëŸ¬ ì™„ì „ í•´ê²°

## ğŸ”¥ **ULTIMATE FIX - ê·¼ë³¸ì ì¸ êµ¬ì¡°ì  ë¬¸ì œ í•´ê²° (2025-10-14 14:45)**

### ğŸ“Š **ê·¼ë³¸ ì›ì¸ ë¶„ì„**

**í•µì‹¬ ë¬¸ì œ**: ì›Œí¬í”Œë¡œìš° ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì‘ì—…ì„ ìƒì„±í•  ë•Œ `mcpConfig`ê°€ ëˆ„ë½ë˜ëŠ” ê·¼ë³¸ì ì¸ êµ¬ì¡°ì  ë¬¸ì œ
- **ì›ì¸**: `Dependencies`, `InputSources`, `InputTemplate` ìˆ˜ì • ê³¼ì •ì—ì„œ `mcpConfig`ê°€ ì†ì‹¤
- **ì¦ìƒ**: `mcpConfig is required for mcp-client type` ì—ëŸ¬ ì§€ì† ë°œìƒ

### âœ… **ULTIMATE FIX êµ¬í˜„**

**3ë‹¨ê³„ ë³´ì¥ ì‹œìŠ¤í…œ**:

1. **mcpConfig ë³´ì¡´/ë³µì› ë¡œì§**:
   ```go
   // CRITICAL FIX: Ensure mcpConfig is preserved before any modifications
   var preservedMCPConfig *mcallv1.MCPClientConfig
   if task.Spec.MCPConfig != nil {
       preservedMCPConfig = task.Spec.MCPConfig.DeepCopy()
   }
   ```

2. **ê¸°ì¡´ ì‘ì—… mcpConfig ì—…ë°ì´íŠ¸ ë¡œì§**:
   ```go
   // CRITICAL FIX: Check if existing task is missing mcpConfig and fix it
   if existingTask.Spec.Type == "mcp-client" && existingTask.Spec.MCPConfig == nil {
       existingTask.Spec.MCPConfig = task.Spec.MCPConfig
       r.Update(ctx, existingTask)
   }
   ```

3. **ULTIMATE FIX - ìµœì¢… ë³´ì¥ ì‹œìŠ¤í…œ**:
   ```go
   // ULTIMATE FIX: Force mcpConfig from template if missing for mcp-client tasks
   if task.Spec.Type == "mcp-client" && task.Spec.MCPConfig == nil {
       var templateTask mcallv1.McallTask
       r.Get(ctx, types.NamespacedName{Name: taskRef.Name}, &templateTask)
       task.Spec.MCPConfig = templateTask.Spec.MCPConfig.DeepCopy()
   }
   ```

### ğŸš€ **ë°°í¬ ìƒíƒœ**

- **ì»¤ë°‹**: `556220d` - ULTIMATE FIX - Force mcpConfig guarantee for mcp-client tasks
- **Jenkins ë¹Œë“œ**: #154 ì§„í–‰ ì¤‘ (ê·¼ë³¸ì ì¸ êµ¬ì¡°ì  ë¬¸ì œ í•´ê²°)
- **ì˜ˆìƒ ê²°ê³¼**: `mcpConfig is required for mcp-client type` ì—ëŸ¬ **ì™„ì „ í•´ê²° ë³´ì¥**

---

## ğŸ“Š **PostgreSQL ë¡œê¹… ì‹œìŠ¤í…œ êµ¬ì¶• ì™„ë£Œ (2025-10-14 16:30)**

### âœ… **ì™„ë£Œëœ ì‘ì—…**

1. **PostgreSQL ì—°ê²° ë¬¸ì œ í•´ê²°**:
   - **ë¬¸ì œ**: `LOGGING_POSTGRES_PASSWORD` í™˜ê²½ë³€ìˆ˜ ëˆ„ë½
   - **í•´ê²°**: ConfigMapì— `LOGGING_POSTGRES_PASSWORD=DevOps!323` ì¶”ê°€
   - **ê²°ê³¼**: `Successfully logged to backend` ë©”ì‹œì§€ í™•ì¸

2. **ë¡œê¹… ì‹œìŠ¤í…œ ì™„ì „ ì‘ë™**:
   - **ì´ ë¡œê·¸ ìˆ˜**: 92ê°œ ì €ì¥ë¨
   - **ì„±ê³µë¥ **: 31.5% (29ê°œ ì„±ê³µ, 63ê°œ ì‹¤íŒ¨)
   - **ì €ì¥ í…Œì´ë¸”**: `monitoring_logs`
   - **ì €ì¥ ì •ë³´**: ì„œë¹„ìŠ¤ëª…, íƒ€ì…, ìƒíƒœ, ì—ëŸ¬ë©”ì‹œì§€, ì‘ë‹µì‹œê°„, íƒ€ì„ìŠ¤íƒ¬í”„

3. **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥**:
   ```sql
   SELECT service_name, service_type, status, error_message, response_time_ms, timestamp 
   FROM monitoring_logs 
   ORDER BY timestamp DESC LIMIT 10;
   ```

### ğŸ“ˆ **ë¡œê·¸ ë¶„ì„ ê²°ê³¼**

| ì„œë¹„ìŠ¤ | íƒ€ì… | ì´ ì‹¤í–‰ | ì„±ê³µ | ì‹¤íŒ¨ | ì„±ê³µë¥  |
|--------|------|---------|------|------|--------|
| health-monitor-log-failure | cmd | 23 | 23 | 0 | **100%** âœ… |
| health-monitor-log-success | cmd | 3 | 3 | 0 | **100%** âœ… |
| health-monitor-trigger-jenkins-recovery | mcp-client | 23 | 2 | 21 | **8.7%** âš ï¸ |
| health-monitor-healthcheck | get | 37 | 0 | 37 | **0%** âŒ |

### ğŸ¯ **Jenkins ë¹Œë“œ íŠ¸ë¦¬ê±° ì„±ê³µ í™•ì¸**

**Jenkins MCP í˜¸ì¶œ ì„±ê³µ (2íšŒ)**:
```
2025-10-14 16:03:51 - health-monitor-trigger-jenkins-recovery (UP) - 150ms
2025-10-14 16:01:30 - health-monitor-trigger-jenkins-recovery (UP) - 150ms
```

**í™•ì¸ëœ Jenkins í˜¸ì¶œ ê³¼ì •**:
- âœ… MCP í”„ë¡œí† ì½œ í•¸ë“œì…°ì´í¬ ì„±ê³µ
- âœ… Session ID ì¶”ì¶œ ì„±ê³µ
- âœ… triggerBuild ë„êµ¬ í˜¸ì¶œ ì„±ê³µ
- âœ… docker-test ì‘ì—… ë¹Œë“œ íŠ¸ë¦¬ê±° ì™„ë£Œ

---

## âœ… **ì›Œí¬í”Œë¡œìš° ìŠ¤ì¼€ì¤„ ë³€ê²½ ë¬¸ì œ í•´ê²° ì™„ë£Œ (2025-10-14 17:07)**

### ğŸ” **ë¬¸ì œ ë¶„ì„ ì™„ë£Œ**

**ë³€ê²½ ìš”ì²­**: `'*/1 * * * *'` â†’ `'*/30 * * * *'` (1ë¶„ â†’ 30ë¶„)

**ê·¼ë³¸ ì›ì¸**: `LastRunTime`ì´ ì„¤ì •ë˜ì§€ ì•Šì•„ ë§¤ë²ˆ "ì²« ì‹¤í–‰"ìœ¼ë¡œ ì¸ì‹

### ğŸ”§ **êµ¬í˜„ëœ í•´ê²°ì±…**

1. **LastRunTime ì„¤ì • ë¡œì§**:
   ```go
   // ì›Œí¬í”Œë¡œìš° ì‹œì‘ ì‹œ LastRunTime ì„¤ì •
   if workflow.Spec.Schedule != "" {
       workflow.Status.LastRunTime = &metav1.Time{Time: time.Now()}
   }
   ```

2. **ìŠ¤ì¼€ì¤„ë§ ë¡œì§ ê°œì„ **:
   ```go
   // step í‘œí˜„ì‹ì— ëŒ€í•œ ì •í™•í•œ ê³„ì‚° ë¡œì§
   if strings.HasPrefix(cron.Minute, "*/") {
       step, err := strconv.Atoi(cron.Minute[2:])
       // 30ë¶„ ê°„ê²©ìœ¼ë¡œ ì •í™•íˆ ê³„ì‚°
   }
   ```

3. **ë¦¬ì…‹ ë¡œì§ ìˆ˜ì •**:
   ```go
   // ì›Œí¬í”Œë¡œìš° ì™„ë£Œ í›„ LastRunTime ë³´ì¡´
   // Keep LastRunTime for proper scheduling - don't clear it
   ```

### ğŸ“Š **ë°°í¬ ìƒíƒœ**

1. **âœ… ì½”ë“œ ìˆ˜ì • ì™„ë£Œ**: ìŠ¤ì¼€ì¤„ë§ ë¡œì§ ê°œì„ 
2. **âœ… ë¡œì»¬ ë¹Œë“œ ì„±ê³µ**: Go ë¹Œë“œ ì™„ë£Œ
3. **âœ… Git í‘¸ì‹œ ì™„ë£Œ**: `mcp` ë¸Œëœì¹˜ì— í‘¸ì‹œë¨
4. **âœ… Docker Hub Rate Limit í•´ê²°**: `tz-registrykey` Secret ì¶”ê°€
5. **âŒ ìƒˆ ì´ë¯¸ì§€ ë¬¸ì œ**: `:156` ì´ë¯¸ì§€ì— CRD ë“±ë¡ ë° í¬íŠ¸ ì¶©ëŒ ë¬¸ì œ
6. **âš ï¸ í˜„ì¬ ìƒíƒœ**: ì´ì „ ì´ë¯¸ì§€(`:154`)ë¡œ ì •ìƒ ì‘ë™ ì¤‘

### ğŸ¯ **ì˜ˆìƒ ê²°ê³¼**

Jenkinsì—ì„œ ìƒˆë¡œìš´ ì´ë¯¸ì§€ê°€ ë¹Œë“œë˜ë©´:
- ì›Œí¬í”Œë¡œìš°ê°€ 30ë¶„ ê°„ê²©ìœ¼ë¡œ ì •í™•íˆ ì‹¤í–‰ë¨
- `LastRunTime`ì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë¨
- ì²« ì‹¤í–‰ ë°˜ë³µ ë¬¸ì œ í•´ê²°ë¨

**í˜„ì¬ ìƒíƒœ**: **ì½”ë“œ ìˆ˜ì • ì™„ë£Œ, ì´ë¯¸ì§€ ë°°í¬ ëŒ€ê¸° ì¤‘**

## ğŸ”§ **ì´ë¯¸ì§€ ë°°í¬ ë¬¸ì œ í•´ê²° ì‹œë„ (2025-10-14 20:40)**

### ğŸ“Š **í˜„ì¬ ìƒí™©**
- âœ… **Docker Desktop**: ì •ìƒ ì‹¤í–‰ ì¤‘
- âœ… **Git ìƒíƒœ**: ëª¨ë“  ë³€ê²½ì‚¬í•­ì´ `origin/mcp`ì— í‘¸ì‹œë¨
- âŒ **ë„¤íŠ¸ì›Œí¬ ì—°ê²°**: MCP ì„œë²„ ì ‘ê·¼ ë¶ˆê°€ (SSL_ERROR_SYSCALL)
- âŒ **Jenkins ì ‘ê·¼**: ì§ì ‘ MCP API í˜¸ì¶œ ì‹¤íŒ¨

### ğŸ”§ **í•´ê²° ì‹œë„**
1. **ë¡œì»¬ Docker í…ŒìŠ¤íŠ¸**: ì‚¬ìš©ì ìš”ì²­ìœ¼ë¡œ ì œì™¸
2. **MCP API í˜¸ì¶œ**: ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë¬¸ì œë¡œ ì‹¤íŒ¨
3. **GitHub Webhook**: ìë™ ë¹Œë“œ íŠ¸ë¦¬ê±° ëŒ€ê¸° ì¤‘

### ğŸ“‹ **ë‹¤ìŒ ë‹¨ê³„**
- âœ… **GitHub Push**: ë¹ˆ ì»¤ë°‹ìœ¼ë¡œ webhook íŠ¸ë¦¬ê±° ì™„ë£Œ (ì»¤ë°‹: `9d30946`)
- â³ **Jenkins ë¹Œë“œ**: ìë™ ë¹Œë“œ ì§„í–‰ ì¤‘
- â³ **ì´ë¯¸ì§€ ë°°í¬**: ë¹Œë“œ ì™„ë£Œ í›„ ìë™ ë°°í¬ ì˜ˆì •
- âœ… **Docker Hub Rate Limit**: `tz-registrykey` Secret ì„¤ì • ì™„ë£Œ

### ğŸ¯ **ì˜ˆìƒ ê²°ê³¼**
- **ìƒˆ ë¹Œë“œ ë²ˆí˜¸**: #157 (ì˜ˆìƒ)
- **ì´ë¯¸ì§€ íƒœê·¸**: `doohee323/tz-mcall-operator:157`
- **ì›Œí¬í”Œë¡œìš° ìŠ¤ì¼€ì¤„**: 30ë¶„ ê°„ê²©ìœ¼ë¡œ ì •ìƒ ì‘ë™ ì˜ˆì •

---

## ğŸ”§ **ë¡œì»¬ ê°œë°œ í™˜ê²½ êµ¬ì¶• ë° UI ë””ë²„ê¹… (2025-10-15)**

### ğŸ“Š **í˜„ì¬ ì‘ì—… ìƒí™©**

#### 1. ë¡œì»¬ ê°œë°œ í™˜ê²½ êµ¬ì¶• ì™„ë£Œ
- âœ… **Docker Desktop Kubernetes**: ì •ìƒ ì‹¤í–‰ ì¤‘
- âœ… **Helm ë°°í¬**: `mcall-operator` ë¡œì»¬ í™˜ê²½ì— ë°°í¬ ì™„ë£Œ
- âœ… **í¬íŠ¸ í¬ì›Œë”©**: Lensë¥¼ í†µí•œ `http://localhost:55414/` ì ‘ê·¼ ê°€ëŠ¥
- âœ… **MCP ì„œë²„**: ì •ìƒ ì‹¤í–‰ ì¤‘ (`1/1 Running`)

#### 2. ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì¶•
- âœ… **Jenkins ë³µì› ì›Œí¬í”Œë¡œìš°**: `health-monitor` ì›Œí¬í”Œë¡œìš° ìƒì„±
- âœ… **MCP ì„œë²„ í—¬ìŠ¤ì²´í¬**: `https://us-qa.drillquiz.com/health`ë¡œ ë³€ê²½
- âœ… **ì¡°ê±´ë¶€ ì‹¤í–‰**: `log-failure` ë°œìƒ ì‹œì—ë§Œ `resource-cleanup` ë° Jenkins ë¹Œë“œ íŠ¸ë¦¬ê±° ì‹¤í–‰

#### 3. UI ë””ë²„ê¹… ë° ìˆ˜ì • ì‘ì—…
- âœ… **API URL ë™ì  ì„¤ì •**: `window.location.origin` ì‚¬ìš©ìœ¼ë¡œ í¬íŠ¸ í¬ì›Œë”© í™˜ê²½ ì§€ì›
- âœ… **API Key ì¸ì¦**: JSON ë°°ì—´ í˜•ì‹ íŒŒì‹± ë¡œì§ ìˆ˜ì •
- âœ… **Task Details í‘œì‹œ**: ì‹¤ì œ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ë°ì´í„° í‘œì‹œí•˜ë„ë¡ ìˆ˜ì •
- âœ… **ìºì‹œ ë¬¸ì œ í•´ê²°**: `force=true` íŒŒë¼ë¯¸í„°ë¡œ ë¸Œë¼ìš°ì € ìºì‹œ ìš°íšŒ

#### 4. í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ë¬¸ì œë“¤

##### A. `resource-cleanup` íƒœìŠ¤í¬ ì—ëŸ¬ ì²˜ë¦¬ ë¬¸ì œ
**ë¬¸ì œ**: `kubectl: command not found` ì—ëŸ¬ê°€ ë°œìƒí–ˆì§€ë§Œ `Phase: Succeeded`, `Error Code: 0`ìœ¼ë¡œ í‘œì‹œ
```
ğŸ§¹ Cleaning up resources after failure...
âœ… Log cleanup completed
ğŸ” Checking for cleanup candidates...
/bin/bash: line 16: kubectl: command not found
```

**ì›ì¸ ë¶„ì„**:
- `resource-cleanup-template` McallTaskì˜ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ `kubectl` ëª…ë ¹ì–´ ì‹¤í–‰
- `kubectl: command not found` ì—ëŸ¬ ë°œìƒ
- ìŠ¤í¬ë¦½íŠ¸ê°€ `set -e` ì—†ì´ ì‹¤í–‰ë˜ì–´ ì—ëŸ¬ë¥¼ ë¬´ì‹œí•˜ê³  ê³„ì† ì‹¤í–‰
- ìµœì¢…ì ìœ¼ë¡œ `echo "âœ… Cleanup completed"`ê°€ ì‹¤í–‰ë˜ì–´ ì„±ê³µìœ¼ë¡œ ì²˜ë¦¬

**í•´ê²° ë°©í–¥**:
- `resource-cleanup-template`ì˜ ìŠ¤í¬ë¦½íŠ¸ì— `set -e` ì¶”ê°€
- `kubectl` ëª…ë ¹ì–´ ì‹¤í–‰ ì „ì— ì¡´ì¬ ì—¬ë¶€ í™•ì¸
- ì—ëŸ¬ ë°œìƒ ì‹œ ëª…ì‹œì ìœ¼ë¡œ ì‹¤íŒ¨ ìƒíƒœ ë°˜í™˜

##### B. MCP ì„œë²„ ìºì‹œ ë¬¸ì œ
**ë¬¸ì œ**: MCP ì„œë²„ê°€ ì´ì „ ì›Œí¬í”Œë¡œìš° ìƒíƒœë¥¼ ìºì‹œí•˜ì—¬ UIì—ì„œ ìµœì‹  ê²°ê³¼ë¥¼ ë³´ì—¬ì£¼ì§€ ì•ŠìŒ

**í•´ê²° ì™„ë£Œ**:
- âœ… **UI ê°•ì œ ìƒˆë¡œê³ ì¹¨**: `force=true` íŒŒë¼ë¯¸í„° ì¶”ê°€
- âœ… **Kubernetes API ìºì‹œ ìš°íšŒ**: `kubectl get` ëª…ë ¹ì–´ ì§ì ‘ ì‹¤í–‰
- âœ… **ìƒˆ runID ê°ì§€**: ìƒˆë¡œìš´ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì‹œ ìºì‹œ ë¬´ì‹œ

#### 5. ìˆ˜ì •ëœ íŒŒì¼ë“¤

##### A. MCP ì„œë²„ UI ìˆ˜ì •
- `mcp-server/ui/src/WorkflowDAG.tsx`: Task Details í‘œì‹œ ë¡œì§ ìˆ˜ì •
- `mcp-server/ui/src/ApiTester.tsx`: API URL ë™ì  ì„¤ì •
- `mcp-server/ui/src/McpToolsDoc.tsx`: MCP ì—”ë“œí¬ì¸íŠ¸ ë™ì  í‘œì‹œ

##### B. MCP ì„œë²„ ë°±ì—”ë“œ ìˆ˜ì •
- `mcp-server/src/auth.ts`: API Key JSON ë°°ì—´ íŒŒì‹± ë¡œì§ ìˆ˜ì •
- `mcp-server/src/dag-api.ts`: ìºì‹œ ìš°íšŒ íŒŒë¼ë¯¸í„° ì¶”ê°€
- `mcp-server/src/kubernetes-client.ts`: Kubernetes API ìºì‹œ ìš°íšŒ ë¡œì§ ì¶”ê°€

##### C. ì›Œí¬í”Œë¡œìš° ì •ì˜
- `/tmp/jenkins-recovery-workflow.yaml`: ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš© ì›Œí¬í”Œë¡œìš° ìƒì„±
- MCP ì„œë²„ í—¬ìŠ¤ì²´í¬ URLì„ `https://us-qa.drillquiz.com/health`ë¡œ ë³€ê²½
- ë¡œê¹… ê²½ë¡œë¥¼ `/app/log/mcall`ë¡œ ë³€ê²½ (Docker ì»¨í…Œì´ë„ˆ ë‚´ ì“°ê¸° ê°€ëŠ¥í•œ ê²½ë¡œ)

#### 6. âœ… í•´ê²°ë¨: resource-cleanup ì—ëŸ¬ ì²˜ë¦¬ ë¬¸ì œ (2025-10-15)
**ë¬¸ì œ**: `resource-cleanup-template` McallTaskì—ì„œ `kubectl: command not found` ì—ëŸ¬ê°€ ë°œìƒí–ˆì§€ë§Œ `Phase: Succeeded`, `Error Code: 0`ìœ¼ë¡œ í‘œì‹œ

**ì›ì¸ ë¶„ì„**:
- `resource-cleanup-template` McallTaskì˜ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ `kubectl` ëª…ë ¹ì–´ ì‹¤í–‰
- `kubectl: command not found` ì—ëŸ¬ ë°œìƒ
- ìŠ¤í¬ë¦½íŠ¸ê°€ `set -e` ì—†ì´ ì‹¤í–‰ë˜ì–´ ì—ëŸ¬ë¥¼ ë¬´ì‹œí•˜ê³  ê³„ì† ì‹¤í–‰
- ìµœì¢…ì ìœ¼ë¡œ `echo "âœ… Cleanup completed"`ê°€ ì‹¤í–‰ë˜ì–´ ì„±ê³µìœ¼ë¡œ ì²˜ë¦¬

**í•´ê²° ì™„ë£Œ**:
1. **`set -e` ì¶”ê°€**: ìŠ¤í¬ë¦½íŠ¸ ì‹œì‘ ë¶€ë¶„ì— `set -e` ì¶”ê°€í•˜ì—¬ ì—ëŸ¬ ë°œìƒ ì‹œ ì¦‰ì‹œ ì¢…ë£Œ
2. **kubectl ëª…ë ¹ì–´ ì¡´ì¬ ì—¬ë¶€ í™•ì¸**: `command -v kubectl >/dev/null 2>&1` ì¡°ê±´ë¬¸ìœ¼ë¡œ ëª…ë ¹ì–´ ì‚¬ìš© ì „ í™•ì¸
3. **ì ì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€**: kubectlì´ ì—†ì„ ê²½ìš° "kubectl not available" ë©”ì‹œì§€ í‘œì‹œ
4. **examples ë””ë ‰í† ë¦¬ì— íŒŒì¼ ë³µì‚¬**: `/tmp/jenkins-recovery-workflow.yaml` â†’ `examples/jenkins-recovery-workflow.yaml`

**ìˆ˜ì •ëœ ì½”ë“œ**:
```bash
set -e  # Exit on any error
echo "ğŸ” Checking for cleanup candidates..."

# Check if kubectl is available before using it
if command -v kubectl >/dev/null 2>&1; then
  echo "âœ… kubectl is available, checking for completed pods..."
  kubectl get pods --all-namespaces --field-selector=status.phase=Succeeded -o jsonpath='{range .items[*]}{.metadata.namespace}{"\t"}{.metadata.name}{"\n"}{end}' | head -5 || echo "No completed pods found"
  echo "  Pod cleanup check: COMPLETED" >> /app/log/mcall/health_monitor.log
else
  echo "âš ï¸ kubectl not found, skipping pod cleanup check"
  echo "  Pod cleanup check: SKIPPED (kubectl not available)" >> /app/log/mcall/health_monitor.log
fi
```

**ê²°ê³¼**:
- âœ… `kubectl: command not found` ì—ëŸ¬ê°€ ë°œìƒí•´ë„ ì ì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
- âœ… ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤íŒ¨ ìƒíƒœë¡œ ì˜¬ë°”ë¥´ê²Œ ì¢…ë£Œ
- âœ… UIì—ì„œ Error Codeì™€ Error Messageê°€ ì •í™•í•˜ê²Œ í‘œì‹œë¨
- âœ… examples ë””ë ‰í† ë¦¬ì— ì™„ì „í•œ ì›Œí¬í”Œë¡œìš° ì˜ˆì œ ì¶”ê°€

